{"ast":null,"code":"import { io } from 'socket.io-client';\nimport { generateId } from '@collab/shared';\nclass SocketService {\n  constructor() {\n    this.socket = null;\n    this.userId = generateId();\n    this.username = `User-${this.userId.slice(0, 6)}`;\n  }\n  connect(serverUrl = 'http://localhost:5000') {\n    var _this$socket;\n    if ((_this$socket = this.socket) !== null && _this$socket !== void 0 && _this$socket.connected) {\n      return this.socket;\n    }\n    this.socket = io(serverUrl);\n\n    // Connection events\n    this.socket.on('connect', () => {\n      var _this$socket2;\n      console.log('Connected to server:', (_this$socket2 = this.socket) === null || _this$socket2 === void 0 ? void 0 : _this$socket2.id);\n    });\n    this.socket.on('disconnect', () => {\n      console.log('Disconnected from server');\n    });\n\n    // Document events\n    this.socket.on('document:initial-load', data => {\n      console.log('Received initial document:', data);\n    });\n    this.socket.on('document:line-updated', data => {\n      console.log('Line updated:', data);\n    });\n\n    // Room events\n    this.socket.on('room:error', data => {\n      console.error('Room error:', data);\n    });\n\n    // Presence events\n    this.socket.on('presence:user-joined', data => {\n      console.log('User joined:', data);\n    });\n    this.socket.on('presence:user-left', data => {\n      console.log('User left:', data);\n    });\n    return this.socket;\n  }\n  joinRoom(roomId) {\n    if (!this.socket) {\n      throw new Error('Socket not connected');\n    }\n    this.socket.emit('room:join', {\n      roomId,\n      userId: this.userId,\n      username: this.username\n    });\n  }\n  editLine(roomId, lineNumber, content) {\n    if (!this.socket) {\n      throw new Error('Socket not connected');\n    }\n    this.socket.emit('document:edit-line', {\n      roomId,\n      lineNumber,\n      content\n    });\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n    }\n  }\n  getSocket() {\n    return this.socket;\n  }\n  getUserInfo() {\n    return {\n      userId: this.userId,\n      username: this.username\n    };\n  }\n}\nexport const socketService = new SocketService();","map":{"version":3,"names":["io","generateId","SocketService","constructor","socket","userId","username","slice","connect","serverUrl","_this$socket","connected","on","_this$socket2","console","log","id","data","error","joinRoom","roomId","Error","emit","editLine","lineNumber","content","disconnect","getSocket","getUserInfo","socketService"],"sources":["/Users/xuy4/collaborative-editor/packages/client/src/services/SocketService.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\nimport { \n  ServerToClientEvents, \n  ClientToServerEvents,\n  generateId \n} from '@collab/shared';\n\ntype TypedSocket = Socket<ServerToClientEvents, ClientToServerEvents>;\n\nclass SocketService {\n  private socket: TypedSocket | null = null;\n  private userId: string = generateId();\n  private username: string = `User-${this.userId.slice(0, 6)}`;\n\n  connect(serverUrl: string = 'http://localhost:5000'): TypedSocket {\n    if (this.socket?.connected) {\n      return this.socket;\n    }\n\n    this.socket = io(serverUrl);\n\n    // Connection events\n    this.socket.on('connect', () => {\n      console.log('Connected to server:', this.socket?.id);\n    });\n\n    this.socket.on('disconnect', () => {\n      console.log('Disconnected from server');\n    });\n\n    // Document events\n    this.socket.on('document:initial-load', (data) => {\n      console.log('Received initial document:', data);\n    });\n\n    this.socket.on('document:line-updated', (data) => {\n      console.log('Line updated:', data);\n    });\n\n    // Room events\n    this.socket.on('room:error', (data) => {\n      console.error('Room error:', data);\n    });\n\n    // Presence events\n    this.socket.on('presence:user-joined', (data) => {\n      console.log('User joined:', data);\n    });\n\n    this.socket.on('presence:user-left', (data) => {\n      console.log('User left:', data);\n    });\n\n    return this.socket;\n  }\n\n  joinRoom(roomId: string): void {\n    if (!this.socket) {\n      throw new Error('Socket not connected');\n    }\n\n    this.socket.emit('room:join', {\n      roomId,\n      userId: this.userId,\n      username: this.username\n    });\n  }\n\n  editLine(roomId: string, lineNumber: number, content: string): void {\n    if (!this.socket) {\n      throw new Error('Socket not connected');\n    }\n\n    this.socket.emit('document:edit-line', {\n      roomId,\n      lineNumber,\n      content\n    });\n  }\n\n  disconnect(): void {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n    }\n  }\n\n  getSocket(): TypedSocket | null {\n    return this.socket;\n  }\n\n  getUserInfo() {\n    return {\n      userId: this.userId,\n      username: this.username\n    };\n  }\n}\n\nexport const socketService = new SocketService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}